<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cart</title>
    <!-- å¼•å…¥cssåŠ¨ç”»åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.0/animate.min.css" type="text/css">
    <style>
        .active {
            background-color: #ddd;
        }
        .message-box {
            padding: 10px 20px;
        }
        .success {
            background-color: rgb(41, 207, 64);
        }
        .warning {
            background-color: rgb(255, 3, 90);
        }
        .message-btn-close {
            float: right;
            margin-right: 20px;
        }
    </style>
   
</head>
<body>
    
    <div id="app">
        <!-- <message :show.sync='show' class="success"> -->
            <!-- å…·åå¡æ§½ -->
            <!-- <template v-slot:title> -->
                <!-- <strong>æ­å–œğŸ‰</strong> -->
            <!-- </template> -->
            <!-- ä½œç”¨åŸŸæ’æ§½ -->
            <!-- <template v-slot:name1='slotName'> <em>{{slotName.name1}}</em> </template> -->
            <!-- é»˜è®¤å¡æ§½ -->
            <!-- <template v-slot:default> æ·»åŠ è¯¾ç¨‹æˆåŠŸï¼</template> -->
        <!-- </message> -->
        <!-- <message :show='showWan' @update:show='showWan=$event' class="warning"> -->
            <!-- å…·åå¡æ§½ -->
            <!-- <template v-slot:title>
                <strong>è­¦å‘Š</strong>
            </template> -->
            <!-- ä½œç”¨åŸŸæ’æ§½ -->
            <!-- <template v-slot:name1='slotName'> <em>{{slotName.name1}}</em> </template> -->
            <!-- é»˜è®¤å¡æ§½ -->
            <!-- <template v-slot:default> è¯·å¡«å†™è¯¾ç¨‹åç§°ï¼</template>
        </message> -->

        <msg-ref class="success" ref='msgSuccess'>
              <!-- å…·åå¡æ§½ -->
              <template v-slot:title>
                <strong>æ­å–œ</strong>
            </template>
            <!-- ä½œç”¨åŸŸæ’æ§½ -->
            <!-- é»˜è®¤å¡æ§½ -->
            <template v-slot:default> æ·»åŠ è¯¾ç¨‹æˆåŠŸ</template>
        </msg-ref>


        <msg-ref class="warning" ref='msgWarning'>
            <!-- å…·åå¡æ§½ -->
            <template v-slot:title>
              <strong>è­¦å‘Š</strong>
          </template>
          <!-- ä½œç”¨åŸŸæ’æ§½ -->
          <!-- é»˜è®¤å¡æ§½ -->
          <template v-slot:default> è¯·å¡«å†™è¯¾ç¨‹åç§°</template>
      </msg-ref>

        <!-- å·®å€¼ -->       
       <h2>
           {{title}}
       </h2>
      <!-- æ‰¹é‡æ¸…é™¤é€šçŸ¥æ  -->
       <button @click='$bus.$emit("msg-close ")'>æ‰¹é‡æ¸…é™¤é€šçŸ¥æ </button>
       <!-- æ‰¹é‡ä¿®æ”¹è¯¾ç¨‹ä»·æ ¼ -->
       <edit-price :value.number='price' @input='price=$event' @edit-price='editPrice'></edit-price>
       <!-- æ·»åŠ è¯¾ç¨‹æ•°æ®äº¤äº’ -->
      <add-courtes v-model='courte' @add-courte9="addCourte" ></add-courtes>
      <!-- <add-courtes :value='courte' @input='courte=$event'  @add-courte9="addCourte"></add-courtes> -->
       <!-- calss -->
       <!-- <div v-for="item in courtes" :key="item" :class='{active: selecedCourte === item}' @click='selecedCourte = item'>
           <div> {{ item }} </div>
       </div> -->
       <!-- style -->
       <!-- <div class="course-list" v-if='courtes.length > 0'>
         <div v-for="item in courtes" :key="item" :style="{'background-color': selecedCourte === item ? '#ddd' : ''}" @click='selecedCourte = item'>
            <div> {{ item }} </div>
          </div> 
       </div> -->
       <!-- æ¡ä»¶æ¸²æŸ“ -->
    
       <courtes-list :courtes='courtes' @remove-c='removeC($event)'> </courtes-list>     
       <!-- å•†å“æ€»æ•° -->
       <!-- è®¡ç®—å±æ€§ -->
       <!-- <p>
           è¯¾ç¨‹æ€»æ•°ï¼š{{total}}
       </p> -->
       <!-- watchå®ç° -->
       è¯¾ç¨‹æ€»æ•°ï¼š{{total_count}}

      <br>æ€»ä»·æ ¼: {{total_price}}
       
    </div>
    <script src="./js/vue.js"></script>
</body>

<script>

Vue.prototype.$bus = new Vue();
    //æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚æ•°æ®
    function getCourtes() {
        return new Promise( resolve => {
            setInterval(() => {
                resolve([{name:'webå…¨æ ˆ'}, {name:'webé«˜çº§'}])
            }, 1000);
        })
    }

    // è¯¾ç¨‹åˆ—è¡¨ç»„ä»¶
    Vue.component('courtes-list', {
        data() {
            return {
                selecedCourte: ''
            }
        },
        props: {
            courtes:{
                type: Array,
                default: [],
            }
        },
        template: `
            <div>
                <div class="course-list" v-if='courtes.length > 0'>
                <div v-for="(item, i) in courtes" :key="i" :style="{'background-color': selecedCourte === item.name ? '#ddd' : ''}" @click='selecedCourte = item.name'>
                <div> {{ item.name }} -- ï¿¥{{item.price}} --- <button @click='removeC(this,item, i)'>X</button> </div>
                </div> 
                </div>
                <p v-else>æ²¡æœ‰ä»»ä½•è¯¾ç¨‹ä¿¡æ¯</p>
            </div>
        `,
        methods: {
            removeC(e, item, i) {
                this.$emit('remove-c', {obj: item, index: i})
            }
        },
    })
    
    //æ·»åŠ è¯¾ç¨‹ç»„å»º
    Vue.component('add-courtes', {
        // data() {
        //     return {
        //         courte: '',
        //     }
        // },
        props: ['value'],
        
        template: `
            <div>
                <input @input='oninput' @keydown.enter='addCourte' type="text" ref='inp' :value='value' /><button @click='addCourte'>æ·»åŠ è¯¾ç¨‹</button>    
            </div>
        `,
        methods: {
            addCourte () {
                //æ´¾å‘ä¸€ä¸ªäº‹ä»¶  æ¥é€šçŸ¥çˆ¶ç»„ä»¶æ–°å¢è¯¾ç¨‹
                this.$emit('add-courte9');
                
                 
            },
            oninput (e) { 
                this.$emit('input', e.target.value)
            }

        },
        mounted () {
            this.$refs.inp.focus()  
        }
      
    })
   
    //æ’æ§½å®ç°å†…å®¹åˆ†å‘ å¼¹çª—ç»„ä»¶é—´  
    Vue.component('message', {
        props:['show'],
        data() {
            return {
                name: 'æ¥è‡ªmessageå†…çš„æ­å–œ'
            }
        },
        template: `
            <div v-if='show' class='message-box'>
                <!-- å…·åå¡æ§½ -->
                <slot name='title'>ğŸ‰ğŸ‰ æ­å–œ ğŸ‰ğŸ‰</slot>
                <!-- ä½œç”¨åŸŸæ’æ§½ -->
                <slot name='name1' :name1='name'></slot>
                <!-- é»˜è®¤å¡æ§½ -->
                <slot></slot>  
                <button class='message-btn-close' @click='close'>X</button>
            </div>
        `,
        methods: {
            close() {
                this.$emit('update:show', false)
            }
        },
        mounted () {
            this.$bus.$on('msg-close', () =>{
                this.$emit('update:show', false)
            })
        },
    })
   
    //å¼¹çª—ç»„ä»¶ ------ ref 
    Vue.component('msg-ref', {
        data() {
            return {
                show: false
            }
        },
        template: `
        <transition enter-active-class='animate__animated animate__bounceIn'  leave-active-class='animate__animated animate__bounceOut'>
            <div v-if='show' class='message-box'>
                <!-- å…·åå¡æ§½ -->
                <slot name='title'>ğŸ‰ğŸ‰ æ­å–œ ğŸ‰ğŸ‰</slot>
                <!-- é»˜è®¤å¡æ§½ -->
                <slot></slot>  
                <button class='message-btn-close' @click='toggle'>X</button>
            </div>
        </transition>
        `,
        methods: {
            toggle() {
                this.show = !this.show
            }
        },
    });

    //æ‰¹é‡ä¿®æ”¹è¯¾ç¨‹ä»·æ ¼ç»„ä»¶
    Vue.component('edit-price', {
        props:['value'],
        template:`
            <div>
                <input type="text" :value='value' @input='onInput'> <button>æ‰¹é‡ä¿®æ”¹</button>    
            </div>
        `,
        methods: {
            onInput(e) {
                this.$emit('input', e.target.value)
                this.$emit('edit-price')
            },
            
        },
    })
   
   

   
    const app = new Vue({
        el: '#app',
        data() {
            return {
                title: 'è¯¾ç¨‹è´­ç‰©è½¦',
                total_count: 0,
                courte: '',
                show: false,
                price: 0,
                showWan:false,
                total_price: 0,
                courtes:[]
            }
        },
        methods: {
            onclick() {
                this.title = 'muah~ æ˜¯ vue å‘€'
            },
            addCourte () {
                if(this.courte) {
                    this.courtes.push({name: this.courte})
                    this.courte = '';
                    this.show = true;
                    this.$refs.msgSuccess.toggle()
                }else {
                    this.showWan = true;
                    this.$refs.msgWarning.toggle()
                }
            },
            editPrice() {
                this.courtes.forEach(obj => {
                    this.$set(obj, 'price', this.price)
                });
            },
            removeC(event) {
                this.courtes.splice(event.index, 1)
            }
    
        },
        async created () {
            //ç»„ä»¶å®ä¾‹å·²åˆ›å»º æœªæŒ‚è½½ dom ä¸å­˜åœ¨
            const c =  await getCourtes();
            this.courtes = c;
            this.editPrice()
        },
        mounted () {
            //å·²æŒ‚è½½ domå·²å­˜åœ¨   

        },
        computed: {
            // è®¡ç®—å±æ€§å…·æœ‰ç¼“å­˜çš„å±æ€§ å¦‚æœä¸å˜åŒ–ä¸ä¼šé‡æ–°è®¡ç®— 
            total() {
                return this.courtes.length + 'é—¨'
            },
            
        },
        // é»˜è®¤æƒ…å†µä¸‹ åªæœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šç›‘å¬  åˆå§‹åŒ–æ—¶ä¸ç›‘å¬
        // watch: {
        //     courtes(newValue, oldValue) {
        //         this.total_count = newValue.length + 'é—¨'
        //     }
        // },
        // åˆå§‹åŒ–æ—¶å°±ä¼šç›‘å¬çš„watch
        watch: {
            courtes: {
                immediate: true, //ç«‹å³æ‰§è¡Œä¸€æ¬¡
                deep: true,
                handler(newValue, oldValue) {
                    this.total_count = newValue.length + 'é—¨'
                    let num= 0;
                    newValue.forEach( obj => {
                        
                        num+= Number(obj.price ? obj.price : 0);
                    })
                    this.total_price = num

                }
            }
        },
    });
    



</script>

</html>